import{d as z,f as L,_ as h,o as u,c as m,a as r,t as b,b as P,e as v,g as D,i as V,r as _,h as B,u as N,W as U,S as C,j as E,w as $,v as R,k as M,l as S,m as T,n as W,p as j}from"./index-0acfdf95.js";const K=z({name:"FileBlock",setup(){return{truncate:(n,t=15)=>{if(n.length<=t)return n;{const e=Math.ceil((t-3)/2),s=Math.floor((t-3)/2);return n.substring(0,e)+"..."+n.substring(n.length-s)}},fileSize:L}},props:{fname:{type:String,required:!0},fsize:{type:Number}}}),q={class:"file-details"},A={class:"file-name"},H={class:"file-size"};function I(o,n,t,e,s,c){const i=D;return u(),m("div",q,[r("div",A,b(o.truncate(o.fname)),1),r("div",H,[P(b(o.fsize?o.fileSize(o.fsize):"unknown")+" ",1),v(i)])])}const G=h(K,[["render",I]]);const J={name:"PanelDownload",setup(){const o=V("notyf"),n=_(!1),t=_(window.location.toString()),e=_(""),s=_(""),c=_(0);B(()=>{t.value&&i()});const i=async()=>{if(n.value)return;const a=t.value;try{n.value=!0;const d=new URL(a),f=d.searchParams.get("filename");let p=d.searchParams.get("value");const x=d.searchParams.get("secret");if(!f||!p){n.value=!1;return}if(x==="true"){const l=N();if(!l.address)throw new Error("Please connect your wallet first");const F=new U(window.ethereum).getSigner(l.address),y=await C.connect("0x3FD611658eE18cC8aa91De4CD5E86FE2a9484309",F).getFile(p).then(w=>w).catch(w=>{throw w});if(!y)throw new Error("File not found or expired");p=y}await E(p).then(l=>{if(!l.cid)throw new Error("File not found or expired");e.value=f,s.value=l.cid.toString(),c.value=l.file.size})}catch(d){const f=d;o.error(f.message)}finally{n.value=!1}};return{inputText:t,isLoading:n,fileName:e,fileSize:c,onURLSubmit:i,onDownloadFile:async()=>{!s.value||!e.value||await W(s.value).then(a=>{j(a,e.value)})}}}},O={id:"panel-download"},Q={class:"search-box"},X=["disabled"],Y=["disabled"],Z={key:0,class:"spinner"};function ee(o,n,t,e,s,c){const i=D,g=G;return u(),m("section",O,[r("div",Q,[$(r("input",{"onUpdate:modelValue":n[0]||(n[0]=a=>e.inputText=a),type:"text",placeholder:"Please input ipfs url or key",onKeyup:n[1]||(n[1]=M((...a)=>e.onURLSubmit&&e.onURLSubmit(...a),["enter"])),disabled:e.isLoading},null,40,X),[[R,e.inputText]]),r("button",{onClick:n[2]||(n[2]=(...a)=>e.onURLSubmit&&e.onURLSubmit(...a)),disabled:e.isLoading},[v(i)],8,Y)]),e.isLoading?(u(),m("div",Z)):S("",!0),!e.isLoading&&e.fileName?(u(),T(g,{key:1,fname:e.fileName,fsize:e.fileSize,onClick:e.onDownloadFile},null,8,["fname","fsize","onClick"])):S("",!0)])}const k=h(J,[["render",ee]]);const ne={name:"VDownload",components:{PanelDownload:k}},oe={id:"content"};function te(o,n,t,e,s,c){const i=k;return u(),m("section",oe,[r("div",null,[v(i)])])}const le=h(ne,[["render",te],["__scopeId","data-v-655d4da0"]]);export{le as default};
