import{d as z,f as L,_ as h,o as u,c as m,a as r,t as b,b as P,e as v,g as D,r as _,h as V,u as B,W as N,S as U,i as C,w as E,v as $,j as R,k as S,l as M,m as T,n as W,p as j}from"./index-47ce7808.js";const K=z({name:"FileBlock",setup(){return{truncate:(n,t=15)=>{if(n.length<=t)return n;{const e=Math.ceil((t-3)/2),a=Math.floor((t-3)/2);return n.substring(0,e)+"..."+n.substring(n.length-a)}},fileSize:L}},props:{fname:{type:String,required:!0},fsize:{type:Number}}}),q={class:"file-details"},A={class:"file-name"},H={class:"file-size"};function I(o,n,t,e,a,c){const i=D;return u(),m("div",q,[r("div",A,b(o.truncate(o.fname)),1),r("div",H,[P(b(o.fsize?o.fileSize(o.fsize):"unknown")+" ",1),v(i)])])}const G=h(K,[["render",I]]);const J={name:"PanelDownload",setup(){const o=T("notyf"),n=_(!1),t=_(window.location.toString()),e=_(""),a=_(""),c=_(0);V(()=>{t.value&&i()});const i=async()=>{if(n.value)return;const s=t.value;try{n.value=!0;const d=new URL(s),f=d.searchParams.get("filename");let p=d.searchParams.get("value");const x=d.searchParams.get("secret");if(!f||!p){n.value=!1;return}if(x==="true"){const l=B();if(!l.address)throw new Error("Please connect your wallet first");const F=new N(window.ethereum).getSigner(l.address),y=await U.connect("0x3FD611658eE18cC8aa91De4CD5E86FE2a9484309",F).getFile(p).then(w=>w).catch(w=>{throw w});if(!y)throw new Error("File not found or expired");p=y}await C(p).then(l=>{if(!l.cid)throw new Error("File not found or expired");e.value=f,a.value=l.cid.toString(),c.value=l.file.size})}catch(d){const f=d;o.error(f.message)}finally{n.value=!1}};return{inputText:t,isLoading:n,fileName:e,fileSize:c,onURLSubmit:i,onDownloadFile:async()=>{!a.value||!e.value||await W(a.value).then(s=>{j(s,e.value)})}}}},O={id:"panel-download"},Q={class:"search-box"},X=["disabled"],Y=["disabled"],Z={key:0,class:"spinner"};function ee(o,n,t,e,a,c){const i=D,g=G;return u(),m("section",O,[r("div",Q,[E(r("input",{"onUpdate:modelValue":n[0]||(n[0]=s=>e.inputText=s),type:"text",placeholder:"Please input ipfs url or key",onKeyup:n[1]||(n[1]=R((...s)=>e.onURLSubmit&&e.onURLSubmit(...s),["enter"])),disabled:e.isLoading},null,40,X),[[$,e.inputText]]),r("button",{onClick:n[2]||(n[2]=(...s)=>e.onURLSubmit&&e.onURLSubmit(...s)),disabled:e.isLoading},[v(i)],8,Y)]),e.isLoading?(u(),m("div",Z)):S("",!0),!e.isLoading&&e.fileName?(u(),M(g,{key:1,fname:e.fileName,fsize:e.fileSize,onClick:e.onDownloadFile},null,8,["fname","fsize","onClick"])):S("",!0)])}const k=h(J,[["render",ee]]);const ne={name:"VDownload",components:{PanelDownload:k},setup(){}},oe={id:"content"};function te(o,n,t,e,a,c){const i=k;return u(),m("section",oe,[r("div",null,[v(i)])])}const le=h(ne,[["render",te],["__scopeId","data-v-39e71488"]]);export{le as default};
